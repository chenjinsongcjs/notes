# 循环依赖

![image.png](https://notes-pic-cjs.oss-cn-chengdu.aliyuncs.com/obsidian/20230611023349.png)

-   [ ] 循环依赖自己分析画图

### 简单总结

1.  A类中含有Blei对象，B类中含有A类对象，构成了相互依赖的情况
    -   在创建A的过程中，GetBean创建A，先去一级缓存中查找A，没有就真正的去创建A
    -   将A加入到一个正在创建的集合中
    -   实例化A
    -   将创建A的工厂放入到三级缓存中。
    -   A属性赋值。发现A中需要B的对象，去创建B的对象。
    -   在一级缓存中去找B没有找到，真正的去创建B，将B加入到正在创建的集合中，实例化B，将B的工厂加入到三级缓存中。
    -   B的属性赋值，发现B需要A，然后去一级缓存中找A，没有找到，创建A，再去以及缓存中找A，没有找到，判断A是否是正在创建的过程中，如果是，就去二级缓存中找，没有找到就去三级缓存中找，找到了A的单例工厂，调用单例工厂，创建A的早期对象，放入到二级缓存中。B从二级缓存中获取A，B属性赋值成功，进行初始化，初始化完成，B创建成功。将B放入到一级缓存中，删除三级缓存和正在创建集合中的B的beanName。
    -   接着A获取到B的对象，进行属性赋值，进行初始化，A创建结束，删除三级缓存，加入一级缓存。
